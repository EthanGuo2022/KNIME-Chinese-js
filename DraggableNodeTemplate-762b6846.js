import{_ as l,bp as h,p as n,y as i,Z as r,bq as g,br as c,b as p,o as m,d as f}from"./index-6dc36896.js";const u={components:{NodeTemplate:h},props:{displayMode:{type:String,default:"icon"},nodeTemplate:{type:Object,default:null},isSelected:{type:Boolean,default:!1},isHighlighted:{type:Boolean,default:!1}},emits:["showNodeDescription"],data(){return{dragGhost:null,shouldShowDescriptionOnAbort:!1}},computed:{...n("panel",["isExtensionPanelOpen"]),...n("workflow",{workflow:"activeWorkflow"}),...i("workflow",["isWritable"]),...i("canvas",["getVisibleFrame"]),...i("selection",["selectedNodes"])},methods:{...r("nodeRepository",["setDraggingNodeTemplate"]),...r("workflow",{addNodeToWorkflow:"addNode"}),onDragStart(e){this.shouldShowDescriptionOnAbort=this.isSelected&&this.isExtensionPanelOpen,this.$store.dispatch("panel/closeExtensionPanel"),this.setDraggingNodeTemplate(this.nodeTemplate),!this.isWritable&&navigator.userAgent.indexOf("Firefox")!==-1&&(e.currentTarget.style.cursor="not-allowed"),this.dragGhost=this.$refs.nodeTemplate.getNodePreview().$el.cloneNode(!0),this.dragGhost.style.position="absolute",this.dragGhost.style.left="-100px",this.dragGhost.style.top="0px",this.dragGhost.style.width="70px",this.dragGhost.style.height="70px",document.body.appendChild(this.dragGhost);const t=this.dragGhost.getBoundingClientRect();e.dataTransfer.setDragImage(this.dragGhost,t.width/2,t.height/2),e.dataTransfer.setData("text/plain",this.nodeTemplate.id),e.dataTransfer.setData(g,JSON.stringify(this.nodeTemplate.nodeFactory))},onDragEnd(e){e.target.style.cursor="pointer",this.setDraggingNodeTemplate(null),this.dragGhost&&(document.body.removeChild(this.dragGhost),this.dragGhost=null),e.dataTransfer.dropEffect==="none"&&this.onDragAbort()},onDragAbort(){this.shouldShowDescriptionOnAbort&&this.$emit("showNodeDescription")},onDoubleClick(){if(!this.isWritable)return;const e=this.selectedNodes.length===1,t=e?{x:this.selectedNodes[0].position.x+120,y:this.selectedNodes[0].position.y}:c.findFreeSpaceAroundCenterWithFallback({visibleFrame:this.getVisibleFrame(),nodes:this.workflow.nodes}),o=e?this.selectedNodes[0].id:null,a=this.nodeTemplate.nodeFactory;this.addNodeToWorkflow({position:t,nodeFactory:a,sourceNodeId:o})},onDrag(e){this.isWritable||(e.currentTarget.style.cursor="not-allowed")}}};function D(e,t,o,a,b,s){const d=p("NodeTemplate");return m(),f(d,{ref:"nodeTemplate",draggable:"true","node-template":o.nodeTemplate,"display-mode":o.displayMode,"is-selected":o.isSelected,"is-highlighted":o.isHighlighted,"show-floating-help-icon":!0,onDragstart:s.onDragStart,onDragend:s.onDragEnd,onDblclick:s.onDoubleClick,onDrag:s.onDrag,onHelpIconClick:t[0]||(t[0]=y=>e.$emit("showNodeDescription"))},null,8,["node-template","display-mode","is-selected","is-highlighted","onDragstart","onDragend","onDblclick","onDrag"])}const N=l(u,[["render",D]]);export{N as D};
