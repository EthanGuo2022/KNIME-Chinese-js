import{x as E,_ as T,o as d,c as _,t as j,b as H,F as N,h as ee,d as g,w as C,g as G,r as me,T as q,f as P,O as c,a as y,n as Y,a0 as ve,j as v,Q as M,Y as _e,U as x,a1 as fe,a2 as ge,a3 as te,a4 as ae,a5 as ye,a6 as U,a7 as oe,G as ke,a8 as R,e as ne,a9 as we,aa as he,ab as L,ac as be,u as se,v as le,ad as Pe,ae as Ce,af as Te,l as Ie,ag as Ee,ah as Ve,ai as $e,D as Me,N as De,B as Ne,aj as O,ak as Se,al as Fe,am as Be,an as We,ao as z,y as Q,ap as je,aq as xe}from"./index-6dc36896.js";import{M as Ue,a as ie,E as de,N as Ae,b as Oe}from"./NodeDescription-22891d06.js";import{T as Re}from"./Tag-c0ba7798.js";import{R as Le}from"./pencil-ca93310a.js";import{T as ze}from"./trash-c1de9387.js";import"./CloseButton-3f01b06f.js";import"./arrow-right-0785f3ac.js";const He=i=>{let l=new Date(i);if(isNaN(l))throw Error("Invalid Date format");return l.toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric"})},Ge=E({props:{lastEdit:{type:String,default:null}},methods:{formatDateString:He}});const Ye={class:"last-updated"},qe={key:0},Qe={key:1};function Je(i,l,s,a,u,t){return d(),_("div",Ye,[i.lastEdit?(d(),_("span",qe,"Last update: "+j(i.formatDateString(i.lastEdit)),1)):(d(),_("span",Qe,"Last update: no update yet"))])}const Ke=T(Ge,[["render",Je],["__scopeId","data-v-2ca863ed"]]);const Xe=5,Ze={components:{Tag:Re},props:{numberOfInitialTags:{type:Number,default:Xe},tags:{type:Array,default:()=>[]},activeTags:{type:Array,default:()=>[]},clickable:{type:Boolean,default:!1}},emits:["click"],data(){return{displayAll:!1}},computed:{tagsToDisplay(){let i=this.tags;return this.displayAll||(i=this.tags.slice(0,this.numberOfInitialTags)),i.map(l=>({isActive:this.activeTags.includes(l),name:l}))},hasMoreTags(){return!this.displayAll&&this.tags.length>this.numberOfInitialTags}},hasMoreTags(){return!this.displayAll&&this.tags.length>this.numberOfInitialTags},methods:{onClick(i){this.clickable&&this.$emit("click",i)},onShowMore(){this.displayAll=!0}}},et={key:0,class:"wrapper"};function tt(i,l,s,a,u,t){const e=H("Tag");return s.tags.length?(d(),_("div",et,[(d(!0),_(N,null,ee(t.tagsToDisplay,(r,p)=>(d(),g(e,{key:p,active:r.isActive,clickable:s.clickable,onClick:q(m=>t.onClick(r.name),["prevent"])},{default:C(()=>[G(j(r.name)+" ",1),me(i.$slots,"icon",{},void 0,!0)]),_:2},1032,["active","clickable","onClick"]))),128)),t.hasMoreTags?(d(),g(e,{key:0,class:"more-tags",onClick:q(t.onShowMore,["prevent"])},{default:C(()=>[G(" +"+j(s.tags.length-s.numberOfInitialTags),1)]),_:1},8,["onClick"])):P("",!0)])):P("",!0)}const at=T(Ze,[["render",tt],["__scopeId","data-v-237d4714"]]),ot=E({__name:"MetadataTags",props:{modelValue:{default:()=>[]},editable:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(i,{emit:l}){const s=i,a=c(()=>s.modelValue.map(e=>({id:e,text:e}))),u=c(()=>a.value.map(({id:e})=>e)),t=e=>{l("update:modelValue",e.map(({text:r})=>r))};return(e,r)=>(d(),_("div",{class:Y(["tags",{editable:e.editable}])},[y("h2",{class:Y(["section",{form:e.editable}])},"Tags",2),e.editable?(d(),g(ve,{key:1,"possible-values":a.value,"model-value":u.value,"size-visible-options":3,"allow-new-values":"",class:"tag-editor",onChange:t},null,8,["possible-values","model-value"])):(d(),_(N,{key:0},[e.modelValue.length?(d(),g(at,{key:0,tags:e.modelValue},null,8,["tags"])):(d(),g(Ue,{key:1,padded:"",text:"No tags have been set yet"}))],64))],2))}});const re=T(ot,[["__scopeId","data-v-fa9d6d3a"]]),nt={class:"buttons"},st=E({__name:"MetadataHeaderButtons",props:{isEditing:{type:Boolean},isValid:{type:Boolean},canOpenWorkflowConfiguration:{type:Boolean,default:!1}},emits:["startEdit","save","openWorkflowConfiguration","cancelEdit"],setup(i){return(l,s)=>(d(),_("div",nt,[!l.isEditing&&l.canOpenWorkflowConfiguration?(d(),g(x,{key:0,title:"Open workflow configuration",onClick:s[0]||(s[0]=a=>l.$emit("openWorkflowConfiguration"))},{default:C(()=>[v(M(_e))]),_:1})):P("",!0),l.isEditing?P("",!0):(d(),g(x,{key:1,title:"Edit metadata","data-test-id":"edit-button",onClick:s[1]||(s[1]=a=>l.$emit("startEdit"))},{default:C(()=>[v(M(Le))]),_:1})),l.isEditing?(d(),g(x,{key:2,disabled:!l.isValid,title:"Save metadata","data-test-id":"save-button",primary:"",onClick:s[2]||(s[2]=a=>l.$emit("save"))},{default:C(()=>[v(M(fe))]),_:1},8,["disabled"])):P("",!0),l.isEditing?(d(),g(x,{key:3,class:"cancel-edit-button",title:"Cancel edit","data-test-id":"cancel-edit-button",onClick:s[3]||(s[3]=a=>l.$emit("cancelEdit"))},{default:C(()=>[v(M(ge))]),_:1})):P("",!0)]))}});const ue=T(st,[["__scopeId","data-v-46827a06"]]),lt={class:"header"},J="#@#",it=E({__name:"ProjectMetadata",emits:["save"],setup(i,{emit:l}){const s=te(),a=c(()=>s.state.workflow.activeWorkflow),u=c(()=>a.value.projectMetadata),t=c(()=>a.value.projectId),e=c(()=>a.value.info.containerId),r=c(()=>u.value.lastEdit.toString()),p=c(()=>`${t.value}${J}${e.value}`),m=ae({}),b=c(()=>m[p.value].isEditing),I=c(()=>s.getters["workflow/isWritable"]),w=c(()=>ye&&I.value),V=()=>u.value?{description:u.value.description.value,links:structuredClone(R(u.value.links||[])),tags:structuredClone(R(u.value.tags||[]))}:{description:"",links:[],tags:[]},k=o=>{m[o]={isEditing:!1,isValid:!0,hasEdited:!1,data:V()}},S=c(()=>m[p.value].isValid),F=o=>{m[p.value].isValid=o},$=()=>{m[p.value].isEditing=!0},B=()=>{k(p.value)},D=o=>m[p.value].data[o],W=(o,n)=>{m[p.value].data[o]=n,m[p.value].hasEdited=!0},A=o=>{const n=m[o],[h,pe]=o.split(J);if(!n.hasEdited){B();return}n.isEditing=!1,n.hasEdited=!1,l("save",{projectId:h,workflowId:pe,links:n.data.links,tags:n.data.tags,description:{value:n.data.description,contentType:oe.ContentTypeEnum.Plain}})};U(p,(o,n)=>{m[n]&&m[n].isEditing&&m[n].hasEdited&&m[n].isValid&&(window.confirm("You are still editing the Workflow metadata, do you want to save your changes?")?A(n):k(n))}),U(u,()=>{u.value&&k(p.value)},{deep:!0,immediate:!0});const f=()=>{ke.desktop.openWorkflowConfiguration(t.value)};return(o,n)=>(d(),_(N,null,[y("div",lt,[v(Ke,{"last-edit":r.value},null,8,["last-edit"]),I.value?(d(),g(ue,{key:0,"is-editing":b.value,"is-valid":S.value,"can-open-workflow-configuration":w.value,onStartEdit:$,onSave:n[0]||(n[0]=h=>A(p.value)),onCancelEdit:B,onOpenWorkflowConfiguration:f},null,8,["is-editing","is-valid","can-open-workflow-configuration"])):P("",!0)]),v(ie,{"original-description":u.value.description.value,"model-value":D("description"),editable:b.value,"onUpdate:modelValue":n[1]||(n[1]=h=>W("description",h))},null,8,["original-description","model-value","editable"]),v(de,{"model-value":D("links"),editable:b.value,"onUpdate:modelValue":n[2]||(n[2]=h=>W("links",h)),onValid:F},null,8,["model-value","editable"]),v(re,{editable:b.value,"model-value":D("tags"),"onUpdate:modelValue":n[3]||(n[3]=h=>W("tags",h))},null,8,["editable","model-value"])],64))}});const dt=T(it,[["__scopeId","data-v-3691f752"]]),rt={class:"port-header"},ut={class:"port-title"},ct=E({__name:"MetadataPortEditor",props:{modelValue:{}},emits:["update:modelValue"],setup(i,{emit:l}){const s=i,a=(u,t,e)=>{l("update:modelValue",s.modelValue.map((r,p)=>e===p?{...r,[u]:t}:r))};return(u,t)=>(d(!0),_(N,null,ee(u.modelValue,(e,r)=>(d(),_("div",{key:r,class:"port-editor"},[y("div",rt,[(d(),g(ne(M(we)(e,12)))),y("div",ut,j(r+1)+": Type: "+j(e.typeName),1)]),v(L,{text:"Name",class:"label"},{default:C(()=>[y("div",null,[v(he,{"model-value":e.name,type:"text",title:"Port name","onUpdate:modelValue":p=>a("name",p,r)},null,8,["model-value","onUpdate:modelValue"])])]),_:2},1024),v(L,{text:"Description",class:"label"},{default:C(()=>[y("div",null,[v(be,{"model-value":e.description,class:"port-description-editor",title:"Port description","onUpdate:modelValue":p=>a("description",p,r)},null,8,["model-value","onUpdate:modelValue"])])]),_:2},1024)]))),128))}});const K=T(ct,[["__scopeId","data-v-5f674fc1"]]),ce=i=>(se("data-v-b587e6c2"),i=i(),le(),i),pt={key:0,class:"node-feature-editor"},mt=ce(()=>y("h2",{class:"section form"},"Input ports",-1)),vt=ce(()=>y("h2",{class:"section form"},"Output ports",-1)),_t=E({__name:"ComponentMetadataNodeFeatures",props:{inPorts:{},outPorts:{},nodeFeatures:{},editable:{type:Boolean,default:!1}},emits:["update:inPorts","update:outPorts"],setup(i,{emit:l}){const s=i,a=c(()=>({inPorts:s.nodeFeatures.inPorts.map((t,e)=>({...t,...s.inPorts[e]})),outPorts:s.nodeFeatures.outPorts.map((t,e)=>({...t,...s.outPorts[e]}))})),u=t=>t.map(({name:e,description:r})=>({name:e,description:r}));return(t,e)=>t.editable?(d(),_("div",pt,[t.inPorts&&t.inPorts.length>0?(d(),_(N,{key:0},[mt,v(K,{"model-value":a.value.inPorts,"onUpdate:modelValue":e[0]||(e[0]=r=>l("update:inPorts",u(r)))},null,8,["model-value"])],64)):P("",!0),t.outPorts&&t.outPorts.length>0?(d(),_(N,{key:1},[vt,v(K,{"model-value":a.value.outPorts,"onUpdate:modelValue":e[1]||(e[1]=r=>l("update:outPorts",u(r)))},null,8,["model-value"])],64)):P("",!0)])):(d(),g(Ae,{key:1,"in-ports":t.nodeFeatures.inPorts,"dyn-in-ports":t.nodeFeatures.dynInPorts,"out-ports":t.nodeFeatures.outPorts,"dyn-out-ports":t.nodeFeatures.dynOutPorts,views:t.nodeFeatures.views,options:t.nodeFeatures.options,"sanitize-content":"",class:"node-feature-list"},null,8,["in-ports","dyn-in-ports","out-ports","dyn-out-ports","views","options"]))}});const ft=T(_t,[["__scopeId","data-v-b587e6c2"]]),gt={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},yt=["fill"],kt=["fill"],wt=E({__name:"ComponentTypeSvgIcon",props:{color:{}},setup(i){return(l,s)=>(d(),_("svg",gt,[y("circle",{cx:"16",cy:"16",r:"16",stroke:"none",fill:M(Pe)},null,8,yt),y("circle",{cx:"16",cy:"16",r:"14",stroke:"none",fill:l.color},null,8,kt)]))}}),ht={class:"type-current-text"},bt=E({__name:"ComponentTypeEditor",props:{componentTypes:{},modelValue:{}},emits:["update:modelValue"],setup(i,{emit:l}){const s=i,a=e=>()=>Ie(wt,{color:Ee[e]||Ve}),u=c(()=>[{text:"Default",icon:a("Component"),metadata:{id:null}},...s.componentTypes.map(e=>({text:e,icon:a(e),metadata:{id:e}}))]),t=c(()=>u.value.find(e=>e.metadata.id===s.modelValue)||{icon:a("Component"),text:"Default"});return(e,r)=>(d(),g(L,{text:"Type",compact:"",class:"label"},{default:C(()=>[y("div",null,[v(Ce,{items:u.value,orientation:"left",class:"type-submenu","teleport-to-body":!1,"positioning-strategy":"absolute",onItemClick:r[0]||(r[0]=(p,m)=>l("update:modelValue",m.metadata.id))},{default:C(({expanded:p})=>[(d(),g(ne(t.value.icon))),y("span",ht,j(t.value.text),1),v(M(Te),{class:Y(["dropdown-icon",{flip:p}])},null,8,["class"])]),_:1},8,["items"])])]),_:1}))}});const Pt=T(bt,[["__scopeId","data-v-36c6f52e"]]),Ct={class:"icon-uploader"},Tt=["src"],X=1024*250,It=E({__name:"IconBase64UploadButton",props:{modelValue:{}},emits:["update:modelValue"],setup(i,{emit:l}){const s=i,a=m=>new Promise((b,I)=>{const w=new FileReader;w.readAsDataURL(m),w.onload=()=>b(w.result??""),w.onerror=V=>I(V)}),u=$e(),t=Me(null),e=()=>{t.value.click()},r=async m=>{const b=m.target;if(!b)return;const[I]=b.files;if(!I)return;if(I.size>X){u.show({type:"error",headline:"Invalid icon",message:`Please choose a smaller file, this one exceeds the maximum file Size of ${X/1024}kb`});return}const w=await a(I);l("update:modelValue",w)},{modelValue:p}=De(s);return U(p,()=>{t.value.value=""}),(m,b)=>(d(),_("div",Ct,[v(Ne,{"with-border":"",compact:"",onClick:e},{default:C(()=>[G(" Select file ")]),_:1}),y("input",{ref_key:"input",ref:t,type:"file",accept:"image/png",onChange:r},null,544),M(p)?(d(),_("img",{key:0,src:M(p),alt:"icon preview",class:"preview"},null,8,Tt)):P("",!0)]))}});const Et=T(It,[["__scopeId","data-v-d846fdec"]]),Vt=E({__name:"ComponentIconEditor",props:{modelValue:{}},emits:["update:modelValue"],setup(i,{emit:l}){return(s,a)=>(d(),g(L,{text:"Icon",compact:"",class:"label"},{default:C(()=>[y("div",null,[v(Et,{"model-value":s.modelValue,"onUpdate:modelValue":a[0]||(a[0]=u=>l("update:modelValue",u))},null,8,["model-value"]),v(x,{class:"delete-link-btn",onClick:a[1]||(a[1]=u=>l("update:modelValue",null))},{default:C(()=>[v(M(ze))]),_:1})])]),_:1}))}});const $t=T(Vt,[["__scopeId","data-v-8897c47c"]]),Mt=i=>(se("data-v-2dcc40c8"),i=i(),le(),i),Dt={class:"header"},Nt={class:"component-name"},St={class:"node-preview"},Ft=["title"],Bt=Mt(()=>y("h2",{class:"section form"},"Type and icon",-1)),Z="#@#",Wt=E({__name:"ComponentMetadata",props:{componentMetadata:{},projectId:{},componentId:{},availablePortTypes:{}},emits:["save"],setup(i,{emit:l}){const s=i,a=c(()=>s.componentMetadata),u=c(()=>{const{inPorts:f=[],outPorts:o=[],options:n,views:h}=a.value;return{inPorts:f.map(O(s.availablePortTypes)),outPorts:o.map(O(s.availablePortTypes)),views:h,options:n}}),t=c(()=>`${s.projectId}${Z}${s.componentId}`),e=ae({}),r=c(()=>e[t.value].isEditing),p=()=>{const f=(u.value.inPorts||[]).map(n=>({name:n.name,description:n.description})),o=(u.value.outPorts||[]).map(n=>({name:n.name,description:n.description}));return{description:a.value.description.value,links:structuredClone(R(a.value.links||[])),tags:structuredClone(R(a.value.tags||[])),inPorts:f,outPorts:o,icon:a.value.icon||"",type:a.value.type||null}},m=f=>{e[f]={isEditing:!1,isValid:!0,hasEdited:!1,data:p()}},b=c(()=>e[t.value].isValid),I=f=>{e[t.value].isValid=f},w=()=>{e[t.value].isEditing=!0},V=()=>{m(t.value)},k=f=>e[t.value].data[f],S=c(()=>k("icon")),F=c(()=>{const{inPorts:f=[],outPorts:o=[]}=a.value,n=k("type"),h=k("icon")||null;return{inPorts:f.map(O(s.availablePortTypes)),outPorts:o.map(O(s.availablePortTypes)),icon:h,type:n,isComponent:!0,hasDynPorts:!1}}),$=(f,o)=>{e[t.value].data[f]=o,e[t.value].hasEdited=!0},B=f=>{const o=e[f],[n,h]=f.split(Z);if(!o.hasEdited){V();return}o.isEditing=!1,o.hasEdited=!1,l("save",{projectId:n,workflowId:h,links:o.data.links,tags:o.data.tags,description:{value:o.data.description,contentType:oe.ContentTypeEnum.Plain},inPorts:o.data.inPorts,outPorts:o.data.outPorts,icon:o.data.icon||null,type:o.data.type})},D=Se(),W=c(()=>D.state.application.availableComponentTypes),A=c(()=>D.getters["workflow/isWritable"]);return U(t,(f,o)=>{e[o]&&e[o].isEditing&&e[o].hasEdited&&e[o].isValid&&(window.confirm("You are still editing the Component metadata, do you want to save your changes?")?B(o):m(o))}),U(a,()=>{a.value&&m(t.value)},{deep:!0,immediate:!0}),(f,o)=>(d(),_(N,null,[y("div",Dt,[y("h2",Nt,[y("span",St,[v(We,Fe(Be(F.value)),null,16)]),y("span",{class:"component-title",title:a.value.name},j(a.value.name),9,Ft)]),A.value?(d(),g(ue,{key:0,"is-editing":r.value,"is-valid":b.value,onStartEdit:w,onSave:o[0]||(o[0]=n=>B(t.value)),onCancelEdit:V},null,8,["is-editing","is-valid"])):P("",!0)]),v(ie,{"original-description":a.value.description.value,"model-value":k("description"),editable:r.value,"onUpdate:modelValue":o[1]||(o[1]=n=>$("description",n))},null,8,["original-description","model-value","editable"]),r.value?(d(),_(N,{key:0},[Bt,v($t,{"model-value":S.value,"onUpdate:modelValue":o[2]||(o[2]=n=>$("icon",n))},null,8,["model-value"]),v(Pt,{"component-types":W.value,"model-value":k("type"),"onUpdate:modelValue":o[3]||(o[3]=n=>$("type",n))},null,8,["component-types","model-value"])],64)):P("",!0),v(de,{"model-value":k("links"),editable:r.value,"onUpdate:modelValue":o[4]||(o[4]=n=>$("links",n)),onValid:I},null,8,["model-value","editable"]),v(re,{editable:r.value,"model-value":k("tags"),"onUpdate:modelValue":o[5]||(o[5]=n=>$("tags",n))},null,8,["editable","model-value"]),v(ft,{"node-features":u.value,"in-ports":k("inPorts"),"out-ports":k("outPorts"),editable:r.value,"onUpdate:inPorts":o[6]||(o[6]=n=>$("inPorts",n)),"onUpdate:outPorts":o[7]||(o[7]=n=>$("outPorts",n))},null,8,["node-features","in-ports","out-ports","editable"])],64))}});const jt=T(Wt,[["__scopeId","data-v-2dcc40c8"]]),xt={key:0,class:"metadata"},Ut={key:1},At=E({__name:"WorkflowMetadata",setup(i){const l=te(),s=c(()=>l.state.application.availablePortTypes),a=c(()=>l.state.workflow.activeWorkflow),u=c(()=>a.value.info.containerType),t=c(()=>u.value===z.ContainerTypeEnum.Project),e=c(()=>u.value===z.ContainerTypeEnum.Component),r=c(()=>t.value&&a.value.projectMetadata&&!a.value.componentMetadata),p=c(()=>(e.value||t.value)&&a.value.componentMetadata&&!a.value.projectMetadata),m=c(()=>u.value===z.ContainerTypeEnum.Metanode),b=({description:w,links:V,tags:k,projectId:S,workflowId:F})=>{l.dispatch("workflow/updateWorkflowMetadata",{projectId:S,workflowId:F,description:w,links:V,tags:k})},I=({projectId:w,workflowId:V,description:k,type:S,icon:F,inPorts:$,outPorts:B,links:D,tags:W})=>{l.dispatch("workflow/updateComponentMetadata",{projectId:w,workflowId:V,description:k,type:S,icon:F,inPorts:$,outPorts:B,links:D,tags:W})};return(w,V)=>a.value&&!m.value?(d(),_("div",xt,[r.value&&a.value.projectMetadata?(d(),g(dt,{key:0,onSave:b})):P("",!0),p.value&&a.value.componentMetadata?(d(),g(jt,{key:1,"component-metadata":a.value.componentMetadata,"project-id":a.value.projectId,"component-id":a.value.info.containerId,"available-port-types":s.value,onSave:I},null,8,["component-metadata","project-id","component-id","available-port-types"])):P("",!0)])):(d(),_("div",Ut))}});const Ot=T(At,[["__scopeId","data-v-d8818a16"]]);const Rt={components:{WorkflowMetadata:Ot,NodeDescription:Oe},computed:{...Q("selection",["singleSelectedNode"]),...Q("workflow",["getNodeName","getNodeFactory"]),showNodeDescription(){return this.singleSelectedNode&&!je(this.singleSelectedNode)},isComponentSelected(){return xe(this.singleSelectedNode)},selectedNode(){if(this.isComponentSelected){const{id:l,name:s}=this.singleSelectedNode;return{id:l,name:s}}const{id:i}=this.singleSelectedNode;return{id:i,name:this.getNodeName(i),nodeFactory:this.getNodeFactory(i)}}}},Lt={class:"context-aware-description"};function zt(i,l,s,a,u,t){const e=H("NodeDescription"),r=H("WorkflowMetadata");return d(),_("div",Lt,[t.showNodeDescription?(d(),g(e,{key:0,class:"node-description","selected-node":t.selectedNode,"is-component":t.isComponentSelected},null,8,["selected-node","is-component"])):(d(),g(r,{key:"workflow-metadata"}))])}const Xt=T(Rt,[["render",zt]]);export{Xt as default};
